<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ruby Pets Shop - Trang mua s·∫Øm c√°c s·∫£n ph·∫©m d√†nh cho th√∫ c∆∞ng</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../style/home.css" />
    <link rel="stylesheet" href="../style/style.css" />
    <link rel="stylesheet" href="../style/footer.css" />
    <link rel="stylesheet" href="../style/cart.css" />
  </head>
  <body>
    <header>
      <input type="checkbox" name="" id="toggler" />
      <label for="toggler" class="fas fa-bars"></label>

      <a href="#" class="logo">Ruby Pets Shop<span>.</span></a>

      <nav class="navbar">
        <a href="home.html">Trang ch·ªß</a>
        <a href="about.html">Gi·ªõi thi·ªáu</a>
        <a href="products.html">Danh m·ª•c s·∫£n ph·∫©m</a>
        <a href="reviews.html">ƒê√°nh gi√°</a>
        <a href="contact.html">Li√™n h·ªá</a>
      </nav>

      <div class="icons">
        <a href="favorite.html" class="fas fa-heart"></a>
        <a href="cart.html" class="fas fa-shopping-cart"></a>
        <a href="login.html" class="fas fa-user" id="user-icon"></a>
      </div>
    </header>
    <main>
      <table>
        <thead>
          <tr>
            <th>H√¨nh ·∫£nh</th>
            <th>T√™n s·∫£n ph·∫©m</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Gi√°</th>
            <th>Th√†nh ti·ªÅn</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody id="cart-body">
          <!-- s·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4" style="text-align: right">
              <strong>T·ªïng thanh to√°n:</strong>
            </td>
            <td colspan="2" id="tong-tien">0ƒë</td>
          </tr>
        </tfoot>
      </table>
    </main>
    <footer class="footer">
      <div class="footer-container">
        <div class="footer-column">
          <h3>L·ªëi t·∫Øt</h3>
          <ul>
            <li><a href="home.html">Trang ch·ªß</a></li>
            <li><a href="about.html">Gi·ªõi thi·ªáu</a></li>
            <li><a href="products.html">Danh m·ª•c s·∫£n ph·∫©m</a></li>
            <li><a href="reviews.html">ƒê√°nh gi√°</a></li>
            <li><a href="contact.html">Li√™n h·ªá</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Li√™n k·∫øt c√° nh√¢n</h3>
          <ul>
            <li><a href="#">T√†i kho·∫£n c·ªßa t√¥i</a></li>
            <li><a href="#">ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
            <li><a href="#">Danh s√°ch y√™u th√≠ch</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Th√¥ng tin li√™n h·ªá</h3>
          <ul>
            <li><a href="#">üìû +84 776147461</a></li>
            <li><a href="#">üìß ngoctth27052004@gmail.com</a></li>
            <li><a href="#">üìç 123 L√™ H·ªìng Phong, Ph∆∞·ªùng 2, Qu·∫≠n 5</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>¬©2025 Ruby Pets Shop. All Rights Reserved.</p>
      </div>
    </footer>

    <script>
      // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
      const username = localStorage.getItem("loggedInUser");
      if (!username) {
        alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem gi·ªè h√†ng!");
        window.location.href = "login.html";
      }

      let cartData = JSON.parse(localStorage.getItem(username + "_cart")) || [];

      const tbody = document.getElementById("cart-body");
      const tongTienEl = document.getElementById("tong-tien");

      function renderCart() {
        tbody.innerHTML = "";
        let tongTien = 0;

        cartData.forEach((item, index) => {
          const giaSo = parseInt(item.gia.replace(/[^\d]/g, ""));
          const thanhTien = giaSo * item.soLuong;
          tongTien += thanhTien;

          const row = document.createElement("tr");
          row.innerHTML = `
            <td><img src="${item.hinhAnh}" width="60"/></td>
            <td>${item.tenSanPham}</td>
            <td>
              <button onclick="thayDoiSoLuong(${index}, -1)">‚ûñ</button>
              <span>${item.soLuong}</span>
              <button onclick="thayDoiSoLuong(${index}, 1)">‚ûï</button>
            </td>
            <td>${item.gia}</td>
            <td>${thanhTien.toLocaleString()}ƒë</td>
            <td><button onclick="xoaSanPham(${index})">‚ùå Xo√°</button></td>
          `;
          tbody.appendChild(row);
        });

        tongTienEl.innerText = tongTien.toLocaleString() + "ƒë";
        localStorage.setItem(username + "_cart", JSON.stringify(cartData));
      }

      function thayDoiSoLuong(index, thayDoi) {
        cartData[index].soLuong += thayDoi;
        if (cartData[index].soLuong < 1) cartData[index].soLuong = 1;
        renderCart();
      }

      function xoaSanPham(index) {
        cartData.splice(index, 1);
        renderCart();
      }

      // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p ƒë·ªÉ c·∫≠p nh·∫≠t icon user
      function updateUserIcon() {
        const loggedInUser = localStorage.getItem("loggedInUser");
        const userIcon = document.getElementById("user-icon");
        if (loggedInUser) {
          userIcon.classList.remove("fa-user");
          userIcon.classList.add("fa-sign-out-alt");
          userIcon.title = "ƒêƒÉng xu·∫•t";
          userIcon.addEventListener("click", function (e) {
            e.preventDefault();
            localStorage.removeItem("loggedInUser");
            alert("ƒê√£ ƒëƒÉng xu·∫•t!");
            window.location.href = "login.html";
          });
        } else {
          userIcon.classList.remove("fa-sign-out-alt");
          userIcon.classList.add("fa-user");
          userIcon.title = "ƒêƒÉng nh·∫≠p";
          userIcon.href = "login.html";
        }
      }

      // G·ªçi h√†m c·∫≠p nh·∫≠t icon khi t·∫£i trang
      updateUserIcon();

      // Render l·∫ßn ƒë·∫ßu
      renderCart();
    </script>
  </body>
</html>
